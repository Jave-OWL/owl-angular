<div class="container">
    <div class="contenedor-imagen">
        <img id="logo" [src]="showLoading ? 'assets/images/OwlCalculo.webp' : 'assets/images/OwlSerio.webp'" alt="Logo" />
    </div>
    <section class="cuestionario" id="cuestionario-riesgo">
        <div id="contenedor-preguntas">
            <!-- Bienvenida: se muestra antes de las preguntas -->
            <div class="bienvenida" *ngIf="showWelcome">
                <h1>¡Bienvenido a OWL!</h1>
                <p>Antes de comenzar, queremos conocer un poco sobre tu tolerancia al riesgo. Responde con sinceridad para obtener un perfil adecuado.</p>
                <button class="btn btn-primary" (click)="startQuestionnaire()">Comenzar cuestionario</button>
            </div>

            <div class="pregunta-scroll" *ngIf="!showWelcome && !showResults && !showLoading">
                <h1>Test de perfil de Riesgo</h1>
                <p class="muted-text">
                    Basado en el test "Grable & Lytton Risk Assessment" &copy;
                    <span></span>
                </p>
                <!-- Preguntas tipo Likert -->
                <div class="pregunta-item" *ngFor="let pregunta of preguntas; let i = index">
                    <div class="pregunta-numero"><!-- Pregunta {{ i + 1 }} / {{ preguntas.length + 2 }} --> {{ i + 1 }} )</div>
                    <p class="pregunta-texto">
                        <ng-container *ngFor="let parte of pregunta.partes">
                            <ng-container *ngIf="isPreguntaParte(parte); else textoNormal">
                                <span class="tooltip-palabra" [attr.data-tooltip]="parte.definicion">{{ parte.palabra }}</span>
                            </ng-container>
                            <ng-template #textoNormal>{{ parte }}</ng-template>
                        </ng-container>
                    </p>
                    <div class="opciones">
                        <label *ngFor="let opcion of pregunta.opciones">
                            <input type="radio" [name]="'pregunta' + (i + 1)" [(ngModel)]="answers[i]" [value]="opcion.valor" />
                            <span>{{ opcion.texto }}</span>
                        </label>
                    </div>
                </div>

                <!-- Pregunta de pacto -->
                <div class="pregunta-item">
                    <div class="pregunta-numero">14</div>
                    <p class="pregunta-texto">
                        {{ preguntaPacto.titulo }}
                    </p>
                    <div class="opciones">
                        <label *ngFor="let opcion of preguntaPacto.opciones">
                            <input type="radio" name="preguntaPacto" [(ngModel)]="respuestaPacto" [value]="opcion.valor" />
                            <span>{{ opcion.texto }}</span>
                        </label>
                    </div>
                </div>

                <!-- Pregunta multiselección: duración de inversión -->
                <div class="pregunta-item">
                    <div class="pregunta-numero">15</div>
                    <p class="pregunta-texto">
                        ¿Cuántos días quieres invertir tu dinero? (Selecciona una o más opciones)
                    </p>
                    <div class="lista-opciones">
                        <label class="opcion-checkbox" *ngFor="let opt of durationOptions">
                            <input type="checkbox" #cb
                                   [checked]="isDurationSelected(opt.id)"
                                   (change)="toggleDuration(opt.id, cb.checked)" />
                            <span>{{ opt.label }}</span>
                        </label>
                    </div>
                </div>

                <!-- Botón de envío -->
                <div class="navigation">
                    <button class="btn btn-submit" 
                            [disabled]="!isFormComplete()" 
                            (click)="submitAnswers()">
                        Terminar cuestionario
                    </button>
                </div>
            </div>

            <!-- Pantalla de carga -->
            <div class="loading-screen" *ngIf="showLoading">
                <div class="loading-content">
                    <h1>Cargando resultados...</h1>
                    <div class="loader"></div>
                </div>
            </div>

            <!-- Resultados -->
            <div class="resultado-card" *ngIf="showResults">
                <h1>¡Cuestionario Completado!</h1>
                <div class="resultado-score">
                    <p class="score-label">Tu Puntuación:</p>
                    <p class="score-value">{{ suma }}</p>
                </div>
                <div class="resultado-perfil">
                    <p class="perfil-label">Perfil Detectado:</p>
                    <p class="perfil-value">{{ resultadoPerfil }}</p>
                </div>
                <button class="btn btn-primary" (click)="resetQuestionnaire()">Volver a tomar el test</button>
                <button class="btn btn-primary" (click)="goToDashboard()">Continuar</button>
            </div>
        </div>
    </section>
</div>