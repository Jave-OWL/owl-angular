<section class="content">
<button class="tour" (click)="startTour()">?</button>
    <div class="titulo">
        <div class="texto">
            <h2>Explora Nuestro Catalogo de Fondos</h2>
            <p class="subtitulo">Encuentra el fondo de inversión que mejor se adapte a tus necesidades.</p>
            <p class="fondos-filtrados">Fondos disponibles: {{fondosFiltrados.length}}</p>
        </div>
            <img hidden id="OwlLupa" src="assets/images/OwlLupa.webp" alt="Logo" />
    </div>
<div class="contenedor-busqueda">
    <div class="search-wrapper">
        <i class="bi bi-search search-icon"></i>
        <div class="separator"></div>
        <input class="input-busqueda" 
               type="text" 
               placeholder="Busca un fondo..."
               (input)="buscarFondos($event)">
    </div>
    <div class="buttons">
        <!-- Dropdown Gestor con logo -->
        <div id="filtro-gestor" class="custom-dropdown with-logo" 
             [class.open]="dropdownGestorAbierto" 
             tabindex="0" 
             (blur)="cerrarDropdownGestor()"
             title="Filtrar por gestor">
            <button type="button" 
                    class="cd-trigger" 
                    (click)="toggleDropdownGestor()" 
                    aria-haspopup="listbox" 
                    [attr.aria-expanded]="dropdownGestorAbierto">
                <img [src]="selectedGestorLogo" class="cd-trigger-logo" [alt]="gestorSeleccionado || 'Gestor'">
                {{ gestorSeleccionado || 'Gestor' }}
                <span class="cd-arrow" aria-hidden="true"></span>
            </button>
            <ul class="cd-list" role="listbox" *ngIf="dropdownGestorAbierto">
                <li role="option" 
                    [class.selected]="gestorSeleccionado === ''"
                    (click)="seleccionarGestor('', 'assets/images/FIC.webp')"
                    tabindex="0">
                    <img src="assets/images/FIC.webp" alt="Todos">
                    Todos
                </li>
                <li role="option" 
                    *ngFor="let gestor of gestoresUnicos"
                    class="with-logo"
                    [class.selected]="gestor === gestorSeleccionado"
                    (click)="seleccionarGestor(gestor, 'assets/images/' + gestor + 'Logo.webp')"
                    tabindex="0">
                    <img [src]="'assets/images/' + gestor + 'Logo.webp'" 
                         [alt]="gestor"
                         (error)="$any($event.target).src='assets/images/FIC.webp'">
                    {{gestor}}
                </li>
            </ul>
        </div>

        <!-- Dropdown Tipo -->
        <div id="filtro-tipo" class="custom-dropdown" 
             [class.open]="dropdownTipoAbierto" 
             tabindex="0" 
             (blur)="cerrarDropdownTipo()"
             title="Filtrar por tipo">
            <button type="button" 
                    class="cd-trigger" 
                    (click)="toggleDropdownTipo()" 
                    aria-haspopup="listbox" 
                    [attr.aria-expanded]="dropdownTipoAbierto">
                {{ tipoFondoSeleccionado || 'Tipo' }}
                <span class="cd-arrow" aria-hidden="true"></span>
            </button>
            <ul class="cd-list" role="listbox" *ngIf="dropdownTipoAbierto">
                <li role="option" 
                    [class.selected]="tipoFondoSeleccionado === ''"
                    (click)="seleccionarTipo('')"
                    tabindex="0">
                    Todos
                </li>
                <li role="option" 
                    *ngFor="let tipo of tiposFondoUnicos"
                    [class.selected]="tipo === tipoFondoSeleccionado"
                    (click)="seleccionarTipo(tipo)"
                    tabindex="0">
                    {{tipo}}
                </li>
            </ul>
        </div>

        <button hidden><i class="bi bi-search"></i></button>

        <!-- Dropdown EA -->
        <div id="filtro-ea" class="custom-dropdown" 
             [class.open]="dropdownEAAbierto" 
             tabindex="0" 
             (blur)="cerrarDropdownEA()"
             title="Tipo de EA">
            <button type="button" 
                    class="cd-trigger" 
                    (click)="toggleDropdownEA()" 
                    aria-haspopup="listbox" 
                    [attr.aria-expanded]="dropdownEAAbierto">
                {{ eaSeleccionado.etiqueta }}
                <span class="cd-arrow" aria-hidden="true"></span>
            </button>
            <ul class="cd-list" role="listbox" *ngIf="dropdownEAAbierto">
                <li role="option" 
                    *ngFor="let opcion of opcionesEA"
                    [class.selected]="opcion.valor === eaSeleccionado.valor"
                    (click)="seleccionarEA(opcion)"
                    tabindex="0">
                    {{opcion.etiqueta}}
                </li>
            </ul>
        </div>

        <!-- Dropdown Ordenar -->
        <div id="filtro-ordenar" class="custom-dropdown" 
             [class.open]="dropdownOrdenarAbierto" 
             tabindex="0" 
             (blur)="cerrarDropdownOrdenar()"
             title="Ordenamiento">
            <button type="button" 
                    class="cd-trigger" 
                    (click)="toggleDropdownOrdenar()" 
                    aria-haspopup="listbox" 
                    [attr.aria-expanded]="dropdownOrdenarAbierto">
                {{ ordenarSeleccionado.etiqueta }}
                <span class="cd-arrow" aria-hidden="true"></span>
            </button>
            <ul class="cd-list" role="listbox" *ngIf="dropdownOrdenarAbierto">
                <li role="option" 
                    *ngFor="let opcion of opcionesOrdenar"
                    [class.selected]="opcion.valor === ordenarSeleccionado.valor"
                    (click)="seleccionarOrdenar(opcion)"
                    tabindex="0">
                    {{opcion.etiqueta}}
                </li>
            </ul>
        </div>
    </div>
</div>

<div class="resultados-recomendados">

</div>

<div *ngIf="fondosFiltrados.length > 0" class="resultados">
    <button *ngFor="let fondo of fondosFiltrados; let i = index" 
            class="fic" 
            [style.animation-delay]="(i * 0.08) + 's'"
            [routerLink]="['/fics/detalle']" 
            [queryParams]="{ id: fondo.id }">
        <div class="info-fic">
            <div class="top">
                <p class="riesgo" [id]="getTipoId(fondo.tipo)">{{fondo.tipo.split(' ')[1]}}</p>
                <img id="logo" [src]="fondo.logo" alt="Logo" />
            </div>
            <div class="bottom">     
                <h5>{{fondo.nombre_fic}}</h5>
                <p>{{fondo.rentabilidad}}</p>
                <div class="ea-container">
                    <p id="ea">{{fondo.ea}}%</p>
                    <div class="hover-info">
                        <div class="triangle"></div>    
                        <div *ngFor="let rentabilidad_historicas of fondo.rentabilidad_historicas" class="rentabilidades">
                            <p>{{rentabilidad_historicas.tipo_de_participacion}} - <span>{{(rentabilidad_historicas.ultimo_mes*100) | number:'1.2-2'}}%</span></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </button>
</div>


<div *ngIf="fondosFiltrados.length === 0 && error === false" class="no-results">
    <span *ngIf="errorBusqueda===false" class="loader"></span>
    <p *ngIf="errorBusqueda===true && error===false" class="no-results">No se encontraron fondos que coincidan con tu busqueda.</p>
</div>

<div *ngIf="error === true" class="error">
    <p class="no-results">Ocurrió un error al cargar los fondos. Por favor, intenta nuevamente más tarde.</p>
</div>
</section>